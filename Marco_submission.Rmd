---
title: "Assignment 2 Submission"
author: "Your name(s)"
date: "submission date"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Statement of Contribution

Include this if pairing.

State what each team member has contributed to the assignment before answering the questions. Each student must contribute towards ALL questions. Your assignment will not be marked without this statement.

```{r eval=FALSE, include=FALSE}
## There are a few options in every chunk, click the setting button (greyed) near the triangle:
# 1. to use default as in the above (show code and output, ie ECHO=TRUE) or 
# 2. to show output only (ie ECHO=FALSE) or
# 3. show nothing (run code) ie include=FALSE
# 4. show nothing (dont run the code), like this chunk, ie eval=FALSE, include=FALSE
## You can knit this template into Word and then update it into pdf etc..
## You can create your own way for submission, this is just an example if you are going to use Rmd.
```

# Question 1: Air Pollution and Mortality. Does pollution kill people? (30 marks)

(a) (5 marks) Carry out exploratory data analysis (EDA) of this dataset.

    **Answer:**

    *Answer text here*

    ```{r}
    # Answer code here
    ```

(b) (9 marks) Perform model selection process using the all subset method to arrive at good regression models that account for variation in mortality between the cities that can be attributed to differences in climate and socioeconomic factors. Identify optimal model(s) based on each of the adjusted R2 , BIC and $C_p$. Use a maximum of 10 variables for the selection. For each criterion, state the number and names of the selected variables.

    **Answer:**

    *Answer text here*

    ```{r}
    # Answer code here
    ```

(c) (4 marks) Fit the model with the lowest $C_p$ as obtained in (b). Write the equation of this fitted model. Interpret this model.

    **Answer:**

    *Answer text here*

    ```{r}
    # Answer code here
    ```

(d) (7 marks) Perform diagnostics checking on the model in (c). Do you think there are influential points in the data? Identify the cities which are influential points using leverage and Cook’s distance respectively.

    **Answer:**

    *Answer text here*

    ```{r}
    # Answer code here
    ```

(e) (5 marks) Using the model obtained in (c), add the three pollution variables (transformed to their natural logarithm) and obtain the p-value from the extrasum-of-squares F-test due to their addition. Summarise your findings in a few concise sentences.

    **Answer:**

    *Answer text here*

    ```{r}
    # Answer code here
    ```

# Question 2: Body Measurements (25 marks)

(a) (4 marks) Carry out exploratory data analysis (EDA) of this dataset before you do any modelling.

    **Answer:**
    
    First, we have a peek at the variables of the dataset using the names() function.
    ```{r echo=FALSE}
    body <- read.csv("body.csv")
    names(body)
    
    ```
    
    Using str() and with the information provided with the task, we know that the dataset is mostly numeric, with 26 variables. With two variables standing out, primarily, X (the row index) and gender (a factor with two levels). I cleaned the data by removing X and performing EDA from then on.
    
    As there are 26 variables, and producing a pairs plot would result in 625 scatterplots, resulting in a plot which is too dense to view meaningfully, we have opted for a heatmap analysis instead.
    ```{r echo=FALSE}
    body_clean <- body[,c(-1)]
    
    library(corrplot)
    
    # Calculate correlation matrix
    cor_matrix <- cor(body_clean, use = "complete.obs")
    
    # Create correlation heatmap
    corrplot(cor_matrix, method = "color", type = "upper", 
             order = "hclust", tl.col = "black", tl.cex = 0.7) 
    ```
    Strong positive correlations appear as dark blue squares, showing many body measurements are highly correlated with each other. Having a look at the heatmap itself, we can see that particularly weight, waist girth, chest girth and various other girth measurements appears to be strongly correlated. Furthermore, Gender shows moderate to strong correlations with many variables (visible in the bottom row), suggesting body measurements differ significantly between genders. Whilst Age seems to have little to no correlation to any other variables.
    
    As gender is a categorical variable, I decided to create boxplots for further analysis with the numeric variables that are most strongly correlated to gender.
    
```{r}
# For multiple variables in a grid
library(ggplot2)
library(gridExtra)
library(purrr)

gender_body <- body_clean
gender_body$Gender <- factor(gender_body$Gender, labels = c("Female", "Male"))

# Function to create individual boxplots
create_boxplot <- function(var_name) {
  ggplot(gender_body, aes_string(x = "factor(Gender)", y = var_name, fill = "factor(Gender)")) +
    geom_boxplot() +
    labs(title = paste(var_name, "by Gender"), x = "Gender", y = var_name) +
    theme_minimal() +
    theme(legend.position = "none")
}

# Select variables with strongest gender correlation
gender_related_vars <- c("Weight", "Height", "Waist.girth", "Elbow.diameter")

# Create plots
plots <- map(gender_related_vars, create_boxplot)

# Arrange in a grid
grid.arrange(grobs = plots, ncol = 2)
```

    For the main response variable, weight, we can see that male has a notably higher median weight (~78kg) to female's median at (~60kg). Both groups show some outliers at the upper end, particularly among females. These measurements show clear sexual dimorphism in human body proportions, with minimal overlap in distributions for measurements like height and waist girth. 

(b) (10 marks) After the exploratory analysis has been carried out, split the dataset into a training set and a testing set so that the training set contains 80% of the data and the testing set contains 20%. Construct a multiple linear regression model for this dataset using the training set based on the following variable selection methods: • (Model 1) The Forward selection; • (Model 2) The Backward selection. Write the two fitted model equations and compare them in a few concise sentences.

    **Answer:**

    We begin by splitting the dataset into a training set and a testing set. Using both forward and backwards selection, we yield the following model equations.

    ```{r}
    # Data Selection
    set.seed(2401)
    test_index <- sample(nrow(body_clean), floor(0.2 * nrow(body_clean)))
    BodyMeasurementsTrain <- body_clean[-test_index, ]
    BodyMeasurementsTest <- body_clean[test_index, ]
    
    ```
    
    ```{r echo = FALSE}
    #Multiple Linear Regression Model
    set.seed(2401) #set seed for reproducibility
    body_lm <- lm(Weight ~ ., data = BodyMeasurementsTrain)
    body_lm_intercept_only <- lm(Weight ~ 1, data = BodyMeasurementsTrain)
    
    #Forward Selection
    body_forward <- step(
      body_lm_intercept_only, 
      scope = ~ (
        Biacromial.diameter + Biiliac.diameter + Bitrochanteric.diameter +
        Chest.depth + Chest.diameter + Elbow.diameter + Wrist.diameter +
        Knee.diameter + Ankle.diameter + Shoulder.girth + Chest.girth +
        Waist.girth + Navel.girth + Hip.girth + Thigh.girth + Bicep.girth +
        Forearm.girth + Knee.girth + Calf.maximum.girth + Ankle.minimum.girth +
        Wrist.minimum.girth + Age + Height + Gender
      ),
      direction = 'forward',
      trace = 0)

    
    #Backwards Selection
    body_backward <- step(
      body_lm,
      direction = 'backward',
      trace = 0
    )
    ```

    The first model given by the forward AIC step function is shown below:
    ```{r echo=FALSE}
    #further work on the forward selection model
    summary(body_forward)
    ```
    We notice that there are some variables tha tare a apart of this model that are not statistically significant, that is, their p-value is greater than 0.05. Taking away these variables with the largest p-value first, we repeat the process until all statistically insignificant variables have been removed or until the overall model fit (adjusted R-squared, AIC, BIC) significantly worsen.
    
    After these steps, the final model is given as below:
    
    ```{r include=FALSE}
    #first removed <- elbow diameter
    body_forward_1 <- lm(Weight ~ Waist.girth + Height + Thigh.girth + Forearm.girth + 
    Shoulder.girth + Calf.maximum.girth + Hip.girth + Chest.girth + 
    Knee.diameter + Age + Chest.depth + Gender + Knee.girth + 
    Chest.diameter + Bicep.girth + Wrist.minimum.girth + 
    Wrist.diameter, 
    
    data = BodyMeasurementsTrain)
    
    summary(body_forward_1)
    ```
    
    ```{r include=FALSE}
    body_forward_2 <- lm(Weight ~ Waist.girth + Height + Thigh.girth + Forearm.girth + 
                        Shoulder.girth + Calf.maximum.girth + Hip.girth + Chest.girth + 
                          Knee.diameter + Age + Chest.depth + Gender + Knee.girth + 
                          Bicep.girth + Wrist.minimum.girth + 
                          Wrist.diameter, 
                        data = BodyMeasurementsTrain)
    
    summary(body_forward_2)
    ```

    ```{r include=FALSE}
    body_forward_3 <- lm(Weight ~ Waist.girth + Height + Thigh.girth + Forearm.girth + 
                        Shoulder.girth + Calf.maximum.girth + Hip.girth + Chest.girth + 
                          Knee.diameter + Age + Chest.depth + Gender + Knee.girth + 
                          Chest.diameter + Wrist.minimum.girth + Wrist.diameter, 
                        data = BodyMeasurementsTrain)
    
    summary(body_forward_3)
    
    ```

    ```{r echo=FALSE}
      body_forward_final <- lm(Weight ~ Waist.girth + Height + Thigh.girth + 
                                 Forearm.girth + Shoulder.girth + Calf.maximum.girth + 
                                 Hip.girth + Chest.girth + Knee.diameter + Age + 
                              Chest.depth + Gender + Knee.girth + Wrist.minimum.girth + 
                                Wrist.diameter, data = BodyMeasurementsTrain)
    
    summary(body_forward_final)
    ```

(c) (5 marks) Perform diagnostics checking for each of the final fitted models, Model 1 and Model 2 respectively.

    **Answer:**

    *Answer text here*

    ```{r}
    # Answer code here
    ```

(d) (6 marks). Despite any inadequacies that you may or may not have identified above, you use the two models obtained in (b) to make predictions of Weight in the test set.

(e) Produce a correctly drawn and labelled plot of predicted values against the actual values in the test set, and obtain the root mean squared error of prediction (RMSEP) based on each fitted model.

<!-- -->

(ii) Using the RMSEPs and the plots you produced, comment on how well the models performed.

````         
**Answer:**

*Answer text here*

```{r}
# Answer code here
```
````
